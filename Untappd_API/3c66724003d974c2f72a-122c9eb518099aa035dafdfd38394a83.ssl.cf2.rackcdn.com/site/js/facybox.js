(function(f){f.fn.fixPNG=function(){return this.each(function(){var l=f(this).css("backgroundImage");if(l.match(/^url\(["']?(.*\.png)["']?\)$/i)){l=RegExp.$1;f(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(f(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+l+"')"}).each(function(){var m=f(this).css("position");if(m!="absolute"&&m!="relative"){f(this).css("position","relative")}})}})};f.facybox=function(m,l){f.facybox.loading();f.facybox.content_klass=l;if(m.ajax){g(m.ajax)}else{if(m.image){e(m.image)}else{if(m.images){i(m.images,m.initial)}else{if(m.div){k(m.div)}else{if(f.isFunction(m)){m.call(f)}else{f.facybox.reveal(m)}}}}}};f.extend(f.facybox,{settings:{opacity:0.3,overlay:true,modal:false,imageTypes:["png","jpg","jpeg","gif"],imageMimeTypes:["image/jpeg","image/png","image/gif"]},html:function(){return'		<div id="facybox" style="display:none;"> 			<div class="popup"> 				<table> 					<tbody> 						<tr> 							<td class="nw"/><td class="n" /><td class="ne"/> 						</tr> 						<tr> 							<td class="w" /> 							<td class="body"> 							<div class="footer"> </div> 							<a href="#" class="close"></a>							<div class="content"> 							</div> 						</td> 							<td class="e"/> 						</tr> 						<tr> 							<td class="sw"/><td class="s"/><td class="se"/> 						</tr> 					</tbody> 				</table> 			</div> 		</div> 		<div class="loading"></div> 	'},loading:function(){j();if(f(".loading",f("#facybox"))[0]){return}d();f.facybox.wait();if(!f.facybox.settings.modal){f(document).bind("keydown.facybox",function(l){if(l.keyCode==27){f.facybox.close()}})}f(document).trigger("loading.facybox")},wait:function(){var l=f("#facybox");f(".content",l).empty();f(".body",l).children().hide().end().append('<div class="loading"></div>');l.fadeIn("fast");f.facybox.centralize();f(document).trigger("reveal.facybox").trigger("afterReveal.facybox")},centralize:function(){var m=f("#facybox");var p=f.facybox.getViewport();var o=parseInt(p[0]/2)-parseInt(m.find("table").width()/2);var l=parseInt(m.height());if(p[1]>l){var n=(p[3]+(p[1]-l)/2);m.css({left:o,top:n})}else{var n=(p[3]+(p[1]/10));m.css({left:o,top:n})}},getViewport:function(){return[f(window).width(),f(window).height(),f(window).scrollLeft(),f(window).scrollTop()]},reveal:function(m){f(document).trigger("beforeReveal.facybox");var l=f("#facybox");f(".content",l).attr("class",(f.facybox.content_klass||"")+" content").html(m);f(".loading",l).remove();var n=f(".body",l);n.children().fadeIn("fast");f.facybox.centralize();f(document).trigger("reveal.facybox").trigger("afterReveal.facybox")},close:function(){f(document).trigger("close.facybox");return false}});f.fn.facybox=function(l){var m=f(this);if(!m[0]){return m}if(l){f.extend(f.facybox.settings,l)}if(!f.facybox.settings.noAutoload){j()}m.bind("click.facybox",function(){f.facybox.loading();var n=this.rel.match(/facybox\[?\.(\w+)\]?/);f.facybox.content_klass=n?n[1]:"";k(this.href);return false});return m};function j(){if(f.facybox.settings.inited){return}else{f.facybox.settings.inited=true}f(document).trigger("init.facybox");h();var l=f.facybox.settings.imageTypes.join("|");f.facybox.settings.imageTypesRegexp=new RegExp(".("+l+")","i");f("body").append(f.facybox.html());var m=f("#facybox");if(f.browser.msie){f(".n, .s, .w, .e, .nw, .ne, .sw, .se",m).fixPNG();if(parseInt(f.browser.version)<=6){var n="<style type='text/css' media='screen'>* html #facybox_overlay { position: absolute; height: expression(document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + 'px');}</style>";f("head").append(n);f(".close",m).fixPNG();f(".close",m).css({right:"15px"})}f(".w, .e",m).css({width:"13px","font-size":"0"}).text("&nbsp;")}if(!f.facybox.settings.noAutoload){a()}f("#facybox .close").click(f.facybox.close)}function a(){f("#facybox").find(".n, .close , .s, .w, .e, .nw, ne, sw, se").each(function(){var l=new Image();l.src=f(this).css("background-image").replace(/^url\(\"?/,"").replace(/\"?\)$/,"")})}function h(){var l=f.facybox.settings;l.imageTypes=l.image_types||l.imageTypes;l.facyboxHtml=l.facybox_html||l.facyboxHtml}function k(l){if(l.match(/#/)){var m=window.location.href.split("#")[0];var n=l.replace(m,"");if(n=="#"){return}f.facybox.reveal(f(n).html(),f.facybox.content_klass)}else{if(l.match(f.facybox.settings.imageTypesRegexp)){e(l)}else{g(l)}}}function i(q,o){var m=f.inArray(o||0,q);if(m==-1){m=0}var n=f("#facybox div.footer");n.append(f('<div class="navigation"><a class="prev"/><a class="next"/><div class="counter"></div></div>'));var l=f("#facybox .navigation");f(document).bind("afterClose.facybox",function(){l.remove()});function p(r){m=(m+r+q.length)%q.length;e(q[m]);l.find(".counter").html(m+1+" / "+q.length)}p(0);f(".prev",l).click(function(){p(-1)});f(".next",l).click(function(){p(1)});f(document).bind("keydown.facybox",function(r){if(r.keyCode==39){p(1)}if(r.keyCode==37){p(-1)}})}function e(m){var l=f("#facybox");f("#facybox .content").empty();f.facybox.loading();var n=new Image();n.onload=function(){f.facybox.reveal('<div class="image"><img src="'+n.src+'" /></div>',f.facybox.content_klass);var q=f("div.footer",l);var r=f("div.content",l);var u=f("div.navigation",l);var o=f("a.next",l);var p=f("a.prev",l);var t=f("div.counter",l);var s=[r.width(),r.height()];q.width(s[0]).height(s[1]);u.width(s[0]).height(s[1]);o.width(parseInt(s[0]/2)).height(s[1]).css({left:(s[0]/2)});p.width(s[0]/2).height(s[1]);t.width(parseInt(l.width()-26)).css({opacity:0.5,"-moz-border-radius":"8px","-webkit-border-radius":"8px"})};n.src=m}function g(l){f.ajax({type:"GET",url:l,complete:function(m,n){content_type=m.getResponseHeader("Content-Type");if(jQuery.inArray(content_type,f.facybox.settings.imageMimeTypes)>=0){e(l);f.facybox.centralize()}else{f.facybox.reveal(m.responseText)}}})}function c(){return f.facybox.settings.overlay==false||f.facybox.settings.opacity===null}function d(){if(c()){return}if(f("#facybox_overlay").length==0){f("body").append('<div id="facybox_overlay" class="facybox_hide"></div>')}f("#facybox_overlay").hide().addClass("facybox_overlayBG").css("opacity",f.facybox.settings.opacity).fadeIn(200);if(!f.facybox.settings.modal){f("#facybox_overlay").click(function(){f(document).trigger("close.facybox")})}}function b(){if(c()){return}f("#facybox_overlay").fadeOut(200,function(){f("#facybox_overlay").removeClass("facybox_overlayBG").addClass("facybox_hide").remove()})}f(document).bind("close.facybox",function(){f(document).unbind("keydown.facybox");var l=f("#facybox");if(f.browser.msie){f("#facybox").hide();b();f("#facybox .loading").remove()}else{f("#facybox").fadeOut("fast",function(){f("#facybox .content").removeClass().addClass("content");b();f("#facybox .loading").remove()})}f(document).trigger("afterClose.facybox")})})(jQuery);